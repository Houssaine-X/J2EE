<div class="product-list-container">
  <!-- Toast for notifications -->
  <p-toast position="top-right"></p-toast>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1>Discover the Future of Shopping</h1>
      <p>Explore our exclusive collection of premium products at unbeatable prices.</p>
    </div>
  </div>

  <!-- Toolbar with Search -->
  <div class="toolbar-section">
    <div class="section-title">
      <h2>Our Products</h2>
    </div>
    <div class="search-wrapper">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          [(ngModel)]="searchKeyword"
          (keyup.enter)="onSearch()"
          placeholder="Search products..."
          class="p-inputtext-sm search-input"
        />
      </span>
    </div>
  </div>

  <div *ngIf="loading$ | async" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading products...</p>
  </div>

  <div *ngIf="error$ | async as error" class="error-message">
    <i class="pi pi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <p-button label="Retry" (onClick)="loadProducts()"></p-button>
  </div>

  <div class="products-grid" *ngIf="!(loading$ | async) && !(error$ | async)">
    <div class="product-card-wrapper" *ngFor="let product of (products$ | async)">
      <p-card styleClass="product-card h-full">
        <ng-template pTemplate="header">
          <div class="product-image-container">
            <img
              [src]="product.imageUrl || 'assets/images/no-image.svg'"
              [alt]="product.nom"
              class="product-image"
            />
            <p-tag
              [value]="getStockLabel(product)"
              [severity]="getStockSeverity(product)"
              styleClass="stock-badge"
            ></p-tag>
          </div>
        </ng-template>

        <div class="product-content">
          <p class="product-category">
            <i class="pi pi-tag"></i>
            {{ product.categoryName }}
          </p>
          <p class="product-description">
            {{ product.description || 'No description available' }}
          </p>
          <div class="product-stock">
            <i class="pi pi-box"></i>
            <span>Stock: {{ product.stockQuantity }}</span>
          </div>
        </div>

        <ng-template pTemplate="footer">
          <div class="product-footer">
            <div class="product-price">
              <span class="price-label">Price:</span>
              <span class="price-value">{{ product.prix | currency: 'EUR' }}</span>
            </div>
            <div class="product-actions">
              <p-button
                icon="pi pi-shopping-cart"
                label="Add to Cart"
                [disabled]="!product.disponible || product.stockQuantity === 0"
                styleClass="p-button-success"
                (onClick)="addToCart(product)"
              ></p-button>
              <p-button
                icon="pi pi-eye"
                styleClass="p-button-text p-button-secondary"
                [routerLink]="['/products', product.id]"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>
  </div>

  <div
    *ngIf="!(loading$ | async) && !(error$ | async) && ((products$ | async)?.length === 0)"
    class="no-products"
  >
    <i class="pi pi-inbox"></i>
    <p>No products found</p>
    <p-button label="Clear Filters" (onClick)="loadProducts()"></p-button>
  </div>
</div>
